{"version":3,"file":"bundle.js","sources":["../node_modules/tslib/tslib.es6.js","../src/request.ts","../src/WebAPIClient.tsx","../src/WebConfig.tsx","../src/GlobalGeoConfig/GlobalGeoConfig.ts","../src/queries.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import axios from \"axios\";\r\n\r\nconst codeMessage = {\r\n  200: \"服务器成功返回请求的数据。\",\r\n  201: \"新建或修改数据成功。\",\r\n  202: \"一个请求已经进入后台排队（异步任务）。\",\r\n  204: \"删除数据成功。\",\r\n  400: \"发出的请求有错误，服务器没有进行新建或修改数据的操作。\",\r\n  401: \"用户没有权限（令牌、用户名、密码错误）。\",\r\n  403: \"用户得到授权，但是访问是被禁止的。\",\r\n  404: \"发出的请求针对的是不存在的记录，服务器没有进行操作。\",\r\n  406: \"请求的格式不可得。\",\r\n  410: \"请求的资源被永久删除，且不会再得到的。\",\r\n  422: \"当创建一个对象时，发生一个验证错误。\",\r\n  500: \"服务器发生错误，请检查服务器。\",\r\n  502: \"网关错误。\",\r\n  503: \"服务不可用，服务器暂时过载或维护。\",\r\n  504: \"网关超时。\"\r\n};\r\n\r\n// axios.defaults.timeout = 5000;\r\naxios.defaults.baseURL = \"../\";\r\naxios.defaults.headers = {\r\n  Accept: 'application/json',\r\n  'Content-Type': 'application/json',\r\n  cache: false,\r\n};\r\n\r\ninterface CustomError {\r\n  url?: string\r\n  method?: string\r\n  status?: string\r\n}\r\n\r\nclass CustomError extends Error {\r\n  constructor(msg, url: string, method: string, status: string) {\r\n    super(msg)\r\n    this.url = url\r\n    this.method = method\r\n    this.status = status\r\n    Object.setPrototypeOf(this, CustomError.prototype)\r\n  }\r\n}\r\n\r\n/**\r\n * 封装axios调用\r\n * @param opts\r\n */\r\nconst request = opts => {\r\n  return axios(opts)\r\n    //@ts-ignore\r\n    .then(res => {\r\n      if (res.status >= 200 && res.status < 300) {\r\n        return res;\r\n      }\r\n    })\r\n    .catch(err => {\r\n      const res = err.response;\r\n      if (!res) {\r\n        const message = err.message;\r\n        console.log(\r\n          `%c *${opts.method.toUpperCase()} ${opts.url}* 请求未正确发送, 错误如下: `,\r\n          \"background: #222; color: #fff; font-weight: bold;\"\r\n        );\r\n        console.log(message);\r\n        throw new CustomError(message, opts.url, opts.method, opts.status);\r\n      } else {\r\n        const message = codeMessage[res.status] || res.statusText;\r\n        console.log(\r\n          `%c *${opts.method.toUpperCase()} ${opts.url}* 请求失败, 响应如下:`,\r\n          \"background: #222; color: #bada55; font-weight: bold;\"\r\n        );\r\n        console.log(res);\r\n        throw new CustomError(message, opts.url, opts.method, opts.status);\r\n      }\r\n    });\r\n}\r\n\r\nclass Axios {\r\n  static get(url: string, queries?: object, _options?: object) {\r\n    return request({\r\n      method: \"get\",\r\n      url,\r\n      params: queries,\r\n      ..._options\r\n    });\r\n  }\r\n\r\n  static post(url: string, data: object, _options?: object) {\r\n    return request({\r\n      method: \"post\",\r\n      url,\r\n      data,\r\n      ..._options\r\n    });\r\n  }\r\n\r\n  static put(url: string, data: object, _options?: object) {\r\n    return request({\r\n      method: \"put\",\r\n      url,\r\n      data,\r\n      ..._options\r\n    });\r\n  }\r\n\r\n  static delete(url: string, _options?: object) {\r\n    return request({\r\n      method: \"delete\",\r\n      url,\r\n      ..._options\r\n    });\r\n  }\r\n}\r\n\r\nexport { Axios };\r\n","// Thingswise Analytic Platform\r\n// Copyright (C) 2015-2018  Thingswise, LLC\r\n// Last edited by Liang(Jeff) Liu - 1904219831@qq.com\r\nimport { Axios } from './request'\r\n\r\nexport interface MetricQuery {\r\n  metricType: string\r\n  name: string\r\n  geo: string\r\n  from?: number\r\n  to?: number\r\n  time?: number\r\n  period: string\r\n  value?: string\r\n  id?: string\r\n}\r\n\r\nexport interface BatchTimeseriesQuery {\r\n  names: {\r\n    [mid: string]: string\r\n  }\r\n  geo: string\r\n  from: number\r\n  to: number\r\n  period: string\r\n}\r\n\r\nexport interface DataPoint {\r\n  name: string\r\n  value: {\r\n    sum: number\r\n    cnt: number\r\n    min: number\r\n    max: number\r\n    stddev: number\r\n  }\r\n}\r\n\r\nexport class WebAPIClient {\r\n\r\n  baseURL: string\r\n\r\n  constructor(baseURL: string) {\r\n    this.baseURL = baseURL || '../'\r\n  }\r\n\r\n\r\n  /**\r\n   * Query parameters:\r\n   *\r\n   * metricType -- (required) one of timeseries, snapshot\r\n   * name -- (required) metric name\r\n   * geo -- (required) encoded geo filter (e.g. China|Beijing|...)\r\n   * from -- for timeseries: timestamp to start with (in milliseconds)\r\n   * to -- for timeseries: timestamp to end with (in milliseconds)\r\n   * time -- for snapshots: timestamp to query (in milliseconds); time will be moved to the boundary of the aggregation period\r\n   * period -- (required) aggregation period (1s, 15s, 1min, 5min, 1h, 1d, 1w)\r\n   * value -- the distribution parameter for snapshot queries (e.g. in vkey:metric for skey by period value is vkey)\r\n   * id -- used to correlate the requests with the chart plots\r\n   * ref -- request sequence number\r\n   * periodicity -- ???\r\n   * periodicSeq -- ???\r\n   *\r\n   * @param queries metric queries\r\n   *\r\n   * @return promise which result is array of metrics data\r\n   */\r\n  getData(queries: MetricQuery[], _options?: object): Promise<any[]> {\r\n    const getDataURI = 'api/view/metric/'\r\n    // return Promise.all(queries.map((q) => {\r\n    //     return Axios.get(getDataURI, {\r\n    //       ...q\r\n    //     }, {\r\n    //       baseURL: this.baseURL,\r\n    //       ..._options\r\n    //     })\r\n    // }))\r\n    return queries.reduce((prev: Promise<any[]>, q) => {\r\n      return prev.then((p: any[]) => {\r\n        return Axios.get(getDataURI, {\r\n          ...q\r\n        }, {\r\n          baseURL: this.baseURL,\r\n          ..._options\r\n        }).then((r: any) => {\r\n          p.push(r)\r\n          return p\r\n        })\r\n      })\r\n    }, Promise.resolve([] as any[]))\r\n  }\r\n\r\n  _constructBatchFuture(multimetricURI: string, queryParams: any, _options: object): Promise<{\r\n    [name: string]: DataPoint[]\r\n  }> {\r\n    return Axios.post(multimetricURI, {\r\n      ...queryParams,\r\n    }, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    }).then(response => {\r\n      const { data } = response.data as {\r\n        data: {\r\n          [mid: string]: {\r\n            name: string,\r\n            data: DataPoint[]\r\n          }\r\n        }\r\n      }\r\n      const result: {\r\n        [name: string]: DataPoint[]\r\n      } = {}\r\n      for (const mid in data) {\r\n        result[data[mid].name] = data[mid].data\r\n      }\r\n      return result\r\n    })\r\n  }\r\n\r\n  getTimeseriesBatch(queries: BatchTimeseriesQuery[], _options?: object): Promise<{\r\n    [name: string]: DataPoint[]\r\n  }[]> {\r\n    const multimetricURI = 'api/view/multimetric/'\r\n\r\n    const futures: Promise<{\r\n      [name: string]: DataPoint[]\r\n    }>[] = []\r\n\r\n    for (const query of queries) {\r\n      const queryParams = {\r\n        metricType: 'timeseries',\r\n        geo: query.geo,\r\n        from: query.from,\r\n        to: query.to,\r\n        period: query.period,\r\n        names: query.names,\r\n      }\r\n      if (Object.keys(queryParams.names).length == 0) {\r\n        futures.push(Promise.resolve({}))\r\n      } else {\r\n        futures.push(this._constructBatchFuture(multimetricURI, queryParams, _options))\r\n      }\r\n    }\r\n\r\n    return Promise.all(futures)\r\n  }\r\n\r\n  /**\r\n   * Query historic data for multiple geos, intervals and periods\r\n   * in a single request using the multimetric `.batches` extension.\r\n   *\r\n   * @param queries the array of query requests. Each request contains\r\n   *   a mapping of metric ID to a metric name to query for the given combination\r\n   *   of geo and interval\r\n   * @returns the promise of the dict which contains combined mapping\r\n   *   of metric IDs to the data point arrays. When input batch requests\r\n   *   contain the same metric ID, the behavior is undetermined\r\n   */\r\n  getTimeseriesMultiBatch(queries: BatchTimeseriesQuery[], noPrune:boolean = false, _options?: object): Promise<{\r\n    [name: string]: DataPoint[]\r\n  }> {\r\n    const multimetricURI = 'api/view/multimetric/'\r\n    return Axios.post(multimetricURI, {\r\n      metricType: 'timeseries',\r\n      batches: queries,\r\n      noPrune\r\n    }, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    }).then(response => {\r\n      const { data } = response.data as {\r\n        data: {\r\n          [mid: string]: {\r\n            name: string,\r\n            data: DataPoint[]\r\n          }\r\n        }\r\n      }\r\n      const result: {\r\n        [name: string]: DataPoint[]\r\n      } = {}\r\n      for (const mid in data) {\r\n        result[mid] = data[mid].data\r\n      }\r\n      return result\r\n    })\r\n  }\r\n\r\n  getConfig = function(this:WebAPIClient,_options?: object) {\r\n    const getConfigURI = 'api/config'\r\n    return Axios.get(getConfigURI, null, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    })\r\n  }\r\n\r\n  getGeoStruct(_options?: object) {\r\n    const getConfigURI = 'api/geo/struct'\r\n    return Axios.get(getConfigURI, null, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    })\r\n  }\r\n\r\n  getDevicesByGeo(geoSpec: any, _options?: object) {\r\n    const getDevicesByGeoURI = 'api/geo/device'\r\n    return Axios.get(getDevicesByGeoURI, geoSpec, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    })\r\n  }\r\n\r\n  getDeviceMetadata(deviceId: string, _options?: object) {\r\n    const getDeviceMetadataURI = 'api/device'\r\n    return Axios.get(getDeviceMetadataURI, { deviceId }, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    })\r\n  }\r\n\r\n  getBinaryObjectURL(collection: string, key: string) {\r\n    return Promise.resolve(this.baseURL + 'api/store/' + collection + '/' + key)\r\n  }\r\n\r\n  /**\r\n   * filter -- a string or an array of strings (for multiple disjuncts)\r\n   * id -- an array of strings\r\n   *\r\n   * Returns a promise of:\r\n   *\r\n   * [\r\n   *   {\r\n   *      \"id\": ...,\r\n   *      \"<domain>\": {\r\n   *          ...\r\n   *      }\r\n   *   }\r\n   * ]\r\n   */\r\n  search(domain: string, filter: string[], id: string[], _options?: object): Promise<{\r\n    id: string,\r\n    [domain: string]: any\r\n  }[]> {\r\n    const searchURI = 'api/search/' + domain\r\n    return Axios.get(searchURI, {\r\n        filter, // TODO ensure that the array of values gets converted into successive query ops\r\n        id: id ? id.join(',') : null,\r\n      }, {\r\n        baseURL: this.baseURL,\r\n        ..._options\r\n      }).then((d) => d.data)\r\n  }\r\n\r\n  createOrUpdateEntity(objId: string, scope: string, domain: string, data: object, _options?: object) {\r\n    const createObjectWithMixinURI = 'api/entity/' + objId\r\n    return Axios.post(createObjectWithMixinURI, { mixinType: domain, mixin: data, scope: scope }, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    })\r\n  }\r\n\r\n  getObjectDomain(objId: string, domain: string, _options?: object) {\r\n    const getObjectMixinURI = 'api/entity/' + objId + '/' + domain\r\n    return Axios.get(getObjectMixinURI, null, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    }).then((d) => d.data)\r\n  }\r\n\r\n  getMapValues(id: string, domain: string, name: string, from: string, to: string, _options?: object) {\r\n    const url = 'api/entity/' + id + '/' + domain + '/map/' + name\r\n    return Axios.get(url, { from, to }, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    })\r\n  }\r\n\r\n  getMapValue(id: string, domain: string, name: string, key: string, _options?: object) {\r\n    const url = 'api/entity/' + id + '/' + domain + '/map/' + name + '/' + key\r\n    return Axios.get(url, null, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    })\r\n  }\r\n\r\n  addValueToMap(id: string, domain: string, name: string, key: string, value: any, _options?: object) {\r\n    const url = 'api/entity/' + id + '/' + domain + '/map/' + name + '/' + key\r\n    return Axios.post(url, { value }, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    })\r\n  }\r\n\r\n  editMapValue(id: string, domain: string, name: string, key: string, value: any, _options?: object) {\r\n    const url = 'api/entity/' + id + '/' + domain + '/map/' + name + '/' + key\r\n    return Axios.put(url, { value }, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    })\r\n  }\r\n\r\n  deleteMapValue(id: string, domain: string, name: string, key: string, _options?: object) {\r\n    const url = 'api/entity/' + id + '/' + domain + '/map/' + name + '/' + key\r\n    return Axios.delete(url, {\r\n      baseURL: this.baseURL,\r\n      ..._options\r\n    })\r\n  }\r\n\r\n}","import * as _ from \"lodash\"\r\nimport { MetricQuery, WebAPIClient } from \"./WebAPIClient\"\r\n\r\n\r\nfunction getLabel(label: string | { i18n: { [locale: string]: string } }, locale: string = \"en-US\"): string {\r\n    if (!label) {\r\n        return \"\";\r\n    }\r\n    if (typeof label === \"string\") {\r\n        return label\r\n    }\r\n    if (label[\"i18n\"]) {\r\n        if (label[\"i18n\"][locale]) {\r\n            return label[\"i18n\"][locale];\r\n        }\r\n        if (label[\"i18n\"][\"en-US\"]) {\r\n            return label[\"i18n\"][\"en-US\"];\r\n        }\r\n        // try to find first non-empty value\r\n        const mbLabel = Object.keys(label[\"i18n\"]).find((e) => { return Boolean(label[\"i18n\"][e]) })\r\n        return mbLabel ? mbLabel : \"\";\r\n    }\r\n    return \"\" + label;\r\n}\r\n\r\nexport function webConfig(webApiURL: string = \"\", config: any = null, mapStruct: any = null, webApiClient: any = null): Promise<WebConfig> {\r\n    if (config != null || mapStruct != null) {\r\n        console.log({ webApiURL, config, mapStruct, webApiClient })\r\n        return Promise.resolve(new WebConfig(config, mapStruct, webApiClient))\r\n    }\r\n    if (webApiClient == null) {\r\n        webApiClient = new WebAPIClient(webApiURL)\r\n    }\r\n    return Promise.all([\r\n        webApiClient.getConfig(),\r\n        webApiClient.getGeoStruct()\r\n    ]).then(([config, mapStruct]) => new WebConfig(config, mapStruct, webApiClient))\r\n}\r\n\r\ninterface Viewport {\r\n    plotType: string\r\n    options: any\r\n    metrics: any[]\r\n    categories: {\r\n        name: string\r\n    }\r\n    periods: string[]\r\n    geoSpecs: string[]\r\n}\r\n\r\ninterface Metric {\r\n    name: string\r\n}\r\n\r\nexport interface GeoSpec {\r\n    [name: string]: string\r\n}\r\n\r\nexport class WebConfig {\r\n\r\n    private config: any\r\n    protected mapStruct: any\r\n    private webApiClient: WebAPIClient\r\n\r\n    constructor(config: any, mapStruct: any, webApiClient: WebAPIClient) {\r\n        this.config = config\r\n        this.mapStruct = mapStruct\r\n        this.webApiClient = webApiClient\r\n    }\r\n\r\n    timeseries(plots: {plotName: string, metricName: string, type?: string }[], locale: string = \"en-US\"): PlotSet {\r\n        const metricSpecs = this.config.metricSpecs || {};\r\n        const plotConfig: any = {}\r\n        const viewport: Viewport = {\r\n            \"plotType\": \"timeseries\",\r\n            \"options\": {\r\n                \"timeseries\":\r\n                    (this.config.defaultPlotOptions !== undefined ?\r\n                        _.cloneDeep(this.config.defaultPlotOptions[\"timeseries\"] || {}) : {})\r\n            },\r\n            \"metrics\": [] as any[],\r\n            \"categories\": {\r\n                \"name\": \"geo\" // or \"metric\" ???\r\n            },\r\n            \"periods\": [\r\n                \"1s\"\r\n            ],\r\n            \"geoSpecs\": null\r\n        }\r\n        let index = 0\r\n        plots.forEach(({plotName, metricName, type = \"y-axis values\"}) => {\r\n            const metricSpec = metricSpecs[metricName];\r\n            if (metricSpec) {\r\n                if (plotConfig[\"yLabel\"] === undefined) {\r\n                    plotConfig[\"yLabel\"] = getLabel(metricSpec[\"unit\"], locale)\r\n                }\r\n                if (plotConfig[\"timezone\"] === undefined) {\r\n                    plotConfig[\"timezone\"] = metricSpec[\"timezone\"]\r\n                }\r\n                plotConfig[type] = plotConfig[type] || {}\r\n                plotConfig[type][plotName] = {\r\n                    \"usedAs\": type,\r\n                    \"decimal\": metricSpec[\"decimal\"] || 0,\r\n                    \"unit\": getLabel(metricSpec[\"unit\"], locale),\r\n                    \"name\": getLabel(metricSpec[\"name\"], locale),\r\n                    \"index\": index++,\r\n                    \"__stats\": metricSpec[\"default-stats\"]\r\n                }\r\n                viewport[\"metrics\"].push({\r\n                    \"id\": plotName,\r\n                    \"periods\": [],\r\n                    \"geoSpecs\": [\"\"],\r\n                    \"name\": metricName,\r\n                    \"metricType\": \"timeseries\"\r\n                })\r\n            } else {\r\n                throw new Error(`Unknown metric ${metricName}`)\r\n            }\r\n        })\r\n\r\n        return new PlotSet(this, plotConfig, viewport, locale)\r\n    }\r\n\r\n    getData(queries: MetricQuery[], _options?: object) {\r\n        return this.webApiClient.getData(queries, _options)\r\n    }\r\n\r\n    search(domain: string, filter: string[], id: string[], _options?: object) {\r\n        return this.webApiClient.search(domain, filter, id, _options)\r\n    }\r\n\r\n    forPlotType(viewport: Viewport, plotTypes: string[]) {        \r\n        for (let i = 0; i < plotTypes.length; i++) {\r\n            if (viewport && viewport.plotType === plotTypes[i]) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    getMetricUsage_(viewport: Viewport) {\r\n        if (this.forPlotType(viewport, ['barchart', 'hbarchart', 'piechart']) && \r\n            viewport.categories != null && viewport.categories.name === 'metric') {\r\n            return 'asCategory';\r\n        } else {\r\n            return 'normal';\r\n        }\r\n    }\r\n\r\n    getValidMetricTypes_(viewport: Viewport, metric: Metric) {\r\n        const metricName = (metric) ? metric.name : (viewport.metrics[0] ? viewport.metrics[0].name : null)\r\n        if (metricName == null) {\r\n            console.error(\"null metric name\")\r\n            return []\r\n        }\r\n        const metricSpec = this.config.metricSpecs[metricName]\r\n\r\n        // new\r\n        if (_.isEmpty(this.config.plotTypes[viewport.plotType]) || \r\n            _.isEmpty(this.config.plotTypes[viewport.plotType].metricUsage)) {\r\n            console.error(\"invalid plotType: \" + viewport.plotType)\r\n            return []\r\n        }\r\n\r\n        const metricUsage = this.getMetricUsage_(viewport);\r\n        const valueTypes = this.config.plotTypes[viewport.plotType].metricUsage[metricUsage]\r\n        if (_.isEmpty(valueTypes)) {\r\n            console.log('empty value types for: ' + viewport.plotType + '.' + metricUsage)\r\n            return []\r\n        }\r\n\r\n        const metricTypes = this.config.plotTypes[viewport.plotType].metricUsage[metricUsage][metricSpec.valueType]\r\n        if (_.isEmpty(metricTypes)) {\r\n            console.log('empty valueType spec for: ' + viewport.plotType + '.' + metricUsage + '.' + metricSpec.valueType)\r\n            return []\r\n        }\r\n\r\n        const metricTypeArr: string[] = []\r\n        metricTypes.forEach(function (mt: string) {\r\n            if (!_.isEmpty(metricSpec.querySpecs[mt])) {\r\n                metricTypeArr.push(mt)\r\n            }\r\n        });\r\n        if (_.isEmpty(metricTypeArr)) { // shouldn't happen\r\n            console.log('metric ' + metricName + ' has no matching metric type ' + metricTypes[0])\r\n        }\r\n        return metricTypeArr\r\n    }\r\n\r\n    getGeoSpecFromGeoNotation(notation: string): GeoSpec {\r\n        if (_.isEmpty(notation)) {\r\n            throw new Error('unexpected empty geo notation')\r\n        }\r\n        const geoFields = notation.split(this.config.geoDelimiter)\r\n        const fieldLen = geoFields.length\r\n        const struct: GeoSpec = {}\r\n        const that = this\r\n        this.config.geoLevels.forEach(function (level: string, index: number) {\r\n            if (fieldLen > index && !that.isGeoFieldEmpty(geoFields[index])) {\r\n                struct[level] = geoFields[index]\r\n            } else {\r\n                struct[level] = ''\r\n            }\r\n        })\r\n        return struct\r\n    }\r\n\r\n    isGeoFieldEmpty(field: string): boolean {\r\n        return _.isEmpty(field) || field === 'none'\r\n    }\r\n\r\n    getGeoNotationFromGeoSpec(geoSpec: GeoSpec): string {\r\n        if (_.isEmpty(geoSpec)) {\r\n            console.warn('unexpected empty geo spec');\r\n            return \"\"\r\n        }\r\n        const geoArr: string[] = [];\r\n        let that = this;\r\n        this.config.geoLevels.some(function (level: string) {\r\n            if (!that.isGeoFieldEmpty(geoSpec[level])) {\r\n                geoArr.push(geoSpec[level]);\r\n                return false\r\n            } else {\r\n                return true;\r\n            }\r\n        })\r\n        return geoArr.join(this.config.geoDelimiter)\r\n    }\r\n\r\n    createOrUpdateEntity(objId: string, scope: string, domain: string, data: object, _options?: object) {\r\n        return this.webApiClient.createOrUpdateEntity(objId, scope, domain, data, _options)\r\n    }\r\n\r\n    getObjectDomain(objId: string, domain: string, _options?: object) {\r\n        return this.webApiClient.getObjectDomain(objId, domain, _options)\r\n    }\r\n\r\n    getMapValues(id: string, domain: string, name: string, from: string, to: string, _options?: object) {\r\n        return this.webApiClient.getMapValues(id, domain, name, from, to, _options)\r\n    }\r\n\r\n    getMapValue(id: string, domain: string, name: string, key: string, _options?: object) {\r\n        return this.webApiClient.getMapValue(id, domain, name, key, _options)\r\n    }\r\n\r\n    addValueToMap(id: string, domain: string, name: string, key: string, value: any, _options?: object) {\r\n        return this.webApiClient.addValueToMap(id, domain, name, key, value, _options)\r\n    }\r\n\r\n    editMapValue(id: string, domain: string, name: string, key: string, value: any, _options?: object) {\r\n        return this.webApiClient.editMapValue(id, domain, name, key, value, _options)\r\n    }\r\n\r\n    deleteMapValue(id: string, domain: string, name: string, key: string, _options?: object) {\r\n        return this.webApiClient.deleteMapValue(id, domain, name, key, _options)\r\n    }\r\n\r\n}\r\n\r\nexport interface Value {\r\n    cnt: number,\r\n    sum: number,\r\n    stddev: number,\r\n    min: number,\r\n    max: number\r\n}\r\n\r\nexport interface DataPoint {\r\n    name: string\r\n    value: Value\r\n}\r\n\r\nexport class PlotSet {\r\n\r\n    private webConfig: WebConfig\r\n    private plotConfig: any\r\n    private viewport: Viewport\r\n    protected locale: string\r\n    protected lastQuery: any\r\n\r\n    constructor(webConfig: WebConfig, plotConfig: any, viewport: Viewport, locale: string = \"en-US\") {\r\n        this.webConfig = webConfig\r\n        this.plotConfig = plotConfig\r\n        this.viewport = viewport\r\n        this.locale = locale\r\n        this.lastQuery = null\r\n    }\r\n\r\n    select(plotName: string | string[], geoSpec: string, period: string) {\r\n        if (_.isArray(plotName)) {\r\n            const that = this;\r\n            plotName.forEach((name) => {\r\n                that.select(name, geoSpec, period)\r\n            })\r\n            return that\r\n        }\r\n        if (!this.viewport[\"metrics\"].some((metric) => {\r\n                if (metric[\"id\"] === plotName) {\r\n                    metric[\"periods\"] = [period]\r\n                    metric[\"geoSpecs\"] = [geoSpec]\r\n                    this.viewport[\"geoSpecs\"] = [geoSpec]\r\n                    return true\r\n                }\r\n                return false\r\n            })) {\r\n            throw new Error(`Unknown plot ${plotName}`)\r\n        }\r\n        return this\r\n    }\r\n\r\n    aggregate(plotName: string, aggType: string) {\r\n        if (this.viewport.plotType === \"timeseries\") {\r\n            for (var type in this.plotConfig) {\r\n                var plot = this.plotConfig[type][plotName];\r\n                if (plot) {\r\n                    plot[\"__stats\"] = aggType\r\n                    return this\r\n                }\r\n            }\r\n            throw new Error(`Unknown plot ${plotName}`)\r\n        } else if (this.viewport.plotType === \"geomap\") {\r\n            if ([\"color\", \"area\"].some((type) => {\r\n                    if (this.plotConfig[type][\"__plot_name\"] === plotName) {\r\n                        this.plotConfig[type][\"__stats\"] = aggType\r\n                        return true\r\n                    }\r\n                    return false\r\n                })) {\r\n                return this\r\n            }\r\n            throw new Error(`Unknown plot ${plotName}`)\r\n        } else {\r\n            throw new Error(`Unsupported plot type ${this.viewport.plotType}`)\r\n        }\r\n    }\r\n\r\n    _get_aggFunction(aggType: string): ((entry: DataPoint) => number) {\r\n        let aggFunction;\r\n        if (aggType === \"avg\" || aggType === \"val\") {\r\n            aggFunction = (entry: DataPoint) => {\r\n                if (entry.value.cnt === 0) {\r\n                    return 0\r\n                } else {\r\n                    return entry.value.sum / entry.value.cnt\r\n                }\r\n            }\r\n        } else if (aggType === \"sum\") {\r\n            aggFunction = (entry: { value: { sum: number }}) => {\r\n                return entry.value.sum\r\n            }\r\n        } else if (aggType === \"cnt\") {\r\n            aggFunction = (entry: { value: { cnt: number }}) => {\r\n                return entry.value.cnt\r\n            }\r\n        } else if (aggType === \"stddev\") {\r\n            aggFunction = (entry: { value: { stddev: number }}) => {\r\n                return entry.value.stddev\r\n            }\r\n        } else {\r\n            console.warn(`Unknown aggregation type ${aggType}`)\r\n            aggFunction = null\r\n        }\r\n        return aggFunction\r\n    }\r\n\r\n    getValueKey(geoNotation: string):Error| string{\r\n        if (this.viewport.plotType === \"geomap\") {\r\n            // TODO\r\n            throw Error(\"Not supported\"+geoNotation)\r\n        }\r\n        return \"\"\r\n    }\r\n\r\n    query({from = 0, to = 0, time = 0, area = null as any}) {\r\n        try {\r\n            const queries = this.viewport[\"metrics\"].map((m) => {\r\n                if (m.geoSpecs.length <= 0) {\r\n                    throw new Error(`geo not set for ${m.name}`)\r\n                }\r\n                if (m.periods.length <= 0) {\r\n                    throw new Error(`period not set for ${m.name}`)\r\n                }\r\n                return {\r\n                    from: from,\r\n                    to: to,\r\n                    time: time,\r\n                    value: area ? this.getValueKey(area) : this.getValueKey(m.geoSpecs[0]),\r\n                    geo: area || m.geoSpecs[0],\r\n                    id: m.id,\r\n                    metricType: m.metricType,\r\n                    name: m.name,\r\n                    period: m.periods[0],\r\n                    ref: m.ref\r\n                }\r\n            }) as MetricQuery[]\r\n            const that = this;\r\n            return this.webConfig.getData(queries ).then((dataBundles) => {\r\n                    this.lastQuery = {from, to, time, area};\r\n                    return new QueryResult(\r\n                        that,\r\n                        {from, to, time, area},\r\n                        dataBundles.map((data: { \r\n                            metricType: string, \r\n                            id: string,\r\n                            data: DataPoint[] \r\n                        }) => {\r\n                            if (data.metricType === \"timeseries\") {\r\n                                console.log(data)\r\n                                console.log(that.plotConfig)\r\n                                if (that.viewport.plotType === \"timeseries\") {\r\n                                    for (var type in that.plotConfig) {\r\n                                        if (!that.plotConfig[type] || !that.plotConfig[type][data.id]) {\r\n                                            continue\r\n                                        }\r\n                                        const aggType = that.plotConfig[type][data.id][\"__stats\"]\r\n                                        var aggFunction = this._get_aggFunction(aggType)\r\n                                        if (aggFunction == null) {\r\n                                            throw new Error(`Unknown aggregation type for plot ${data.id}`)\r\n                                        }\r\n                                        return new Timeseries(data.data.map((entry: DataPoint) => {\r\n                                            return {\r\n                                                date: Number(entry.name) * 1000.,\r\n                                                value: aggFunction(entry)\r\n                                            }\r\n                                        }))                                            \r\n                                    }\r\n                                    throw new Error(`Unknown plot id ${data.id}`)\r\n                                }\r\n                                throw new Error(`Unsupported viewport type ${that.viewport.plotType} for metric ${data.metricType}`)\r\n                            } else if (data.metricType === \"snapshot\") {\r\n                                if (that.viewport.plotType === \"geomap\") {\r\n                                    const type = [\"area\", \"color\"].find((type) => {\r\n                                        return data.id in that.plotConfig[type];\r\n                                    });\r\n                                    if (type) {\r\n                                        const aggType = that.plotConfig[type][data.id][\"__stats\"]\r\n                                        var aggFunction = this._get_aggFunction(aggType)\r\n                                        if (aggFunction == null) {\r\n                                            throw new Error(`Unknown aggregation type for plot ${data.id}`)\r\n                                        }\r\n                                        return new Snapshot(data.data.map((entry: DataPoint) => {\r\n                                            return {\r\n                                                name: entry.name, // TODO ?????\r\n                                                value: aggFunction(entry)\r\n                                            }\r\n                                        }))\r\n                                    }\r\n                                    throw new Error(`Unknown plot id ${data.id}`)\r\n                                }\r\n                                throw new Error(`Unsupported viewport type ${that.viewport.plotType} for metric ${data.metricType}`)\r\n                            }\r\n                            throw new Error(`Metric type ${data.metricType} not supported`)\r\n                        }))\r\n                }\r\n            )\r\n        } catch (e) {\r\n            return Promise.reject(e)\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport class QueryResult {\r\n\r\n    private plotSet: any\r\n    private from: number\r\n    private to: number\r\n    private time: number\r\n    private area: string\r\n    private data: (Timeseries | Snapshot)[]\r\n\r\n    constructor(plotSet: PlotSet, {from = 0, to = 0, time = 0, area = null as string}, data: (Timeseries | Snapshot)[]) {\r\n        this.plotSet = plotSet\r\n        this.from = from\r\n        this.to = to\r\n        this.time = time\r\n        this.area = area\r\n        this.data = data\r\n    }\r\n\r\n    timeseries(index: number): Timeseries {\r\n        if (this.data[index] instanceof Timeseries) {\r\n            return this.data[index] as Timeseries\r\n        }\r\n        throw new Error(\"Incompatible data bundle type\")\r\n    }\r\n\r\n    snapshot(index: number): Snapshot {\r\n        if (this.data[index] instanceof Snapshot) {\r\n            return this.data[index] as Snapshot\r\n        }\r\n        throw new Error(\"Incompatible data bundle type\")\r\n    }\r\n\r\n    repeat({from = -1, to = -1, time = -1, area = null as any}) {\r\n        return this.plotSet.query(\r\n            {\r\n                from: from >= 0 ? from : this.from,\r\n                to: to >= 0 ? to : this.to,\r\n                time: time >= 0 ? time : this.time,\r\n                area: area !== null ? area : this.area\r\n            })\r\n    }\r\n}\r\n\r\ninterface TimeseriesDataPoint {\r\n    date: number,\r\n    value: number\r\n}\r\n\r\nclass Timeseries {\r\n    \r\n    private data: TimeseriesDataPoint[]\r\n\r\n    constructor(data: TimeseriesDataPoint[]) {\r\n        this.data = data\r\n    }\r\n\r\n    getData(): TimeseriesDataPoint[] {\r\n        return this.data\r\n    }\r\n\r\n}\r\n\r\ninterface SnapshotDataPoint {\r\n    name: string,\r\n    value: number\r\n}\r\n\r\nclass Snapshot {\r\n\r\n    private data: SnapshotDataPoint[]\r\n\r\n    constructor(data: SnapshotDataPoint[]) {\r\n        this.data = data\r\n    }\r\n\r\n    getData(): SnapshotDataPoint[] {\r\n        return this.data\r\n    }\r\n}\r\n","import { cloneDeep } from 'lodash'\r\nimport { AnnotatedWebConfig } from '../queries'\r\n// 组织或设备名与geo信息对照表\r\n// 各应用根据组织或设备名获取指定的geo\r\nconst GeoStructObj: GeoStruct = {}\r\nconst property = '_config';\r\n\r\nconst env = global ? global : window\r\n\r\n/**\r\n * 组织或设备名与geo信息对照表数据接口\r\n *\r\n * @export\r\n * @interface GeoStruct\r\n */\r\nexport interface GeoStruct {\r\n    [name: string]: {\r\n        class: string[]\r\n        geo: string\r\n        level: string\r\n        name: {\r\n            cn: string\r\n            en: string\r\n        }\r\n    }\r\n}\r\n\r\ndeclare global {\r\n    interface Window {\r\n        //@ts-ignore\r\n        _config: AnnotatedWebConfig\r\n    }\r\n}\r\n//@ts-ignore\r\ndeclare module NodeJS {\r\n    interface Global {\r\n        //@ts-ignore\r\n        _config: AnnotatedWebConfig\r\n    }\r\n}\r\n\r\n/**\r\n * 初始化GeoStructObj\r\n *\r\n * @export\r\n * @param {*} struct\r\n * @param {string[]} levels\r\n * @returns {GeoStruct}\r\n */\r\nexport function setGeoStruct(struct: any, levels: string[]) {\r\n    let geoLevels = levels.slice()\r\n    // 全局geo信息未初始化，且存在指定层级，且存在对应层级信息\r\n    if (geoLevels && Array.isArray(geoLevels) && geoLevels.length > 0) {\r\n        const level = geoLevels.shift()\r\n        if (Object.prototype.hasOwnProperty.call(struct, level)) {\r\n            const obj = struct[level]\r\n            if (obj) {\r\n                // 循环当前层级的每项组织或设备\r\n                Object.keys(obj).forEach(key => {\r\n                    const tmp = obj[key]\r\n                    const className = tmp.class[0].fqn\r\n\r\n                    GeoStructObj[tmp.name] = {\r\n                        geo: _getGeoByClass(className, tmp.name),\r\n                        class: tmp.class.map(item => item.fqn),\r\n                        level,\r\n                        name: { en: tmp.name, cn: tmp.i18n['zh-CN'] },\r\n                    }\r\n\r\n                    // 存在下级则递归\r\n                    setGeoStruct(tmp, geoLevels.slice())\r\n                })\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n/**\r\n*根据指定组织结构层级和类型（组织或设备）拼接geo\r\n*\r\n* @private\r\n* @param {string} className 类名\r\n* @param {string} name 设备名\r\n* @returns\r\n*/\r\nfunction _getGeoByClass(className: string, name: string): string {\r\n    if (className && className.length > 0) {\r\n        const arr = env[property].findObjects({ classes: [className] })\r\n        // 查找指定设备\r\n        const geoObj = arr.find(item => item.spec.name === name)\r\n        // 存在设备\r\n        if (geoObj) {\r\n            // 获取完整geo组织层级\r\n            const geoLevels = env[property].getGeoRootLevels()\r\n            // 按照指定组织层级拼接geo\r\n            return geoLevels\r\n                .reduce((geo, level) => {\r\n                    if (geoObj.key[level]) {\r\n                        geo.push(geoObj.key[level])\r\n                    }\r\n                    return geo\r\n                }, new Array<string>())\r\n                .join('|')\r\n        }\r\n    }\r\n    return ''\r\n}\r\n\r\n/**\r\n * 获取全局组织或设备名与geo信息对照表\r\n *\r\n * @export\r\n * @returns {GeoStruct}\r\n */\r\nexport default function getorSetGeoStruct(): GeoStruct {\r\n    if (Object.keys(GeoStructObj).length === 0) {\r\n        setGeoStruct(env[property].getMapStruct(), env[property].getGeoSubLevels())\r\n    }\r\n    return cloneDeep(GeoStructObj)\r\n}\r\n\r\n/**\r\n * 根据指定的组织或设备的类，获取同类下所有的geo\r\n *\r\n * @param {string} className 设备或组织所属的类\r\n * @returns {string[]} geo数组\r\n */\r\nexport function getGeoByClassName(className: string): string[] {\r\n    if (className && className.length > 0) {\r\n        const arr = env[property].findObjects({ classes: [className] })\r\n        // 存在同类组织或设备信息\r\n        if (arr.length > 0) {\r\n            // 获取完整geo组织层级\r\n            const geoLevels = env[property].getGeoRootLevels()\r\n            return arr.map(item => {\r\n                // 按照指定组织层级拼接geo\r\n                return geoLevels\r\n                    .reduce((geo, level) => {\r\n                        if (item.key[level]) {\r\n                            geo.push(item.key[level])\r\n                        }\r\n                        return geo\r\n                    }, new Array<string>())\r\n                    .join('|')\r\n            })\r\n        }\r\n    }\r\n    return new Array<string>()\r\n}","import { BatchTimeseriesQuery, MetricQuery, WebAPIClient } from './WebAPIClient'\r\nimport { DataPoint, GeoSpec, Value, WebConfig } from './WebConfig'\r\n\r\nimport { cloneDeep } from 'lodash'\r\n\r\nimport { setGeoStruct } from './GlobalGeoConfig/GlobalGeoConfig'\r\n\r\ninterface I18n {\r\n\t[lang: string]: string\r\n}\r\n\r\ninterface InternationalizedLabel {\r\n\ti18n: I18n\r\n}\r\n\r\ntype ALabel = string | InternationalizedLabel\r\n\r\nexport function getLabel(label: ALabel, locale: string): string {\r\n\tif ((label as InternationalizedLabel).i18n) {\r\n\t\tconst i18n = (label as InternationalizedLabel).i18n\r\n\t\tif (i18n[locale]) {\r\n\t\t\treturn i18n[locale]\r\n\t\t} else {\r\n\t\t\tfor (const key of Object.keys(i18n)) {\r\n\t\t\t\treturn i18n[key]\r\n\t\t\t}\r\n\t\t\treturn ''\r\n\t\t}\r\n\t} else {\r\n\t\treturn label as string\r\n\t}\r\n}\r\n\r\nexport interface AnnotatedMetricSpec {\r\n\tname: ALabel\r\n\tvalueType: string\r\n\t['default-stats']: string\r\n\tquerySpecs: {\r\n\t\ttimeseries: {\r\n\t\t\t[scope: string]: any\r\n\t\t}\r\n\t}\r\n\tnote: ALabel\r\n\ttimezone: string\r\n\tdecimal: number\r\n\tunit: ALabel\r\n\tcategory: string | string[]\r\n\t// annotations\r\n\taxis?: string | undefined | null\r\n\taxisValue?: string | undefined | null\r\n\tdomain?: string | undefined | null\r\n\tmetric?: string | undefined | null\r\n\tcategoryList?: string[]\r\n}\r\n\r\nexport interface FieldSpec {\r\n\tname: ALabel\r\n\tnote: ALabel\r\n\tdecimal: number\r\n\tunit: ALabel\r\n}\r\n\r\nexport interface ObjectSpec {\r\n\taxis?: {\r\n\t\t[axisName: string]: string[]\r\n\t}\r\n\tclass?: Array<{\r\n\t\ti18n?: I18n\r\n\t\tfqn: string\r\n\t}>\r\n\tname: string\r\n}\r\n\r\n// to see $project/data/metric-specs.json\r\ninterface AnnotatedWebAPIConfig {\r\n\tgeoSubLevels: string[]\r\n\tmetricSpecs: {\r\n\t\t[metricName: string]: AnnotatedMetricSpec\r\n\t}\r\n\tgeoLevels: string[]\r\n\r\n\t// an index into the metric specs:\r\n\t// - the top level is the list of Domains (Consumption, Generation, PurchasePrice, ...)\r\n\t// - the second level is the metric category (Water, ...)\r\n\t// - the third level is the metric spec itself (oxygen, ...)\r\n\tfieldSpecs: {\r\n\t\t[domain: string]: {\r\n\t\t\t[category: string]: {\r\n\t\t\t\t[metric: string]: FieldSpec\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction annotateWebConfig(config: AnnotatedWebAPIConfig) {\r\n\t// The compile method is deprecated\r\n\t// const r = new RegExp(/^(((([a-zA-Z0-9_]+)\\$([a-zA-Z0-9_]+))\\.)?([a-zA-Z0-9_]+)\\.)?([a-zA-Z0-9_]+)$/, 'g')\r\n\t// for browser ie11\r\n\tconst r = /^(((([a-zA-Z0-9_]+)\\$([a-zA-Z0-9_]+))\\.)?([a-zA-Z0-9_]+)\\.)?([a-zA-Z0-9_]+)$/g\r\n\tconfig.fieldSpecs = {}\r\n\t// [\"process$boiler.Consumption.purchased_electricity\", \"process$boiler.Consumption.\", \"process$boiler.\", \"process$boiler\", \"process\", \"boiler\", \"Consumption\", \"purchased_electricity\", index: 0, input: \"process$boiler.Consumption.purchased_electricity\", groups: undefined]\r\n\tfor (const metricName of Object.keys(config.metricSpecs)) {\r\n\t\tr.lastIndex = 0\r\n\t\tconst components = r.exec(metricName)\r\n\t\tif (components !== null) {\r\n\t\t\tconfig.metricSpecs[metricName].axis = components[4] !== '' ? components[4] : null\r\n\t\t\tconfig.metricSpecs[metricName].axisValue = components[5] !== '' ? components[5] : null\r\n\t\t\tconfig.metricSpecs[metricName].domain = components[6] !== '' ? components[6] : null\r\n\t\t\tconfig.metricSpecs[metricName].metric = components[7] !== '' ? components[7] : null\r\n\r\n\t\t\tconst category = config.metricSpecs[metricName].category\r\n\t\t\tlet categoryString: string | null\r\n\t\t\tlet categoryList: string[]\r\n\t\t\tif (category !== null && typeof category === 'string') {\r\n\t\t\t\tcategoryString = category as string\r\n\t\t\t\tcategoryList = [categoryString]\r\n\t\t\t} else if (category !== null && Array.isArray(category)) {\r\n\t\t\t\tcategoryList = category as string[]\r\n\t\t\t\tcategoryString = categoryList.length > 0 ? categoryList[0] : null\r\n\t\t\t} else {\r\n\t\t\t\tcategoryString = null\r\n\t\t\t\tcategoryList = []\r\n\t\t\t}\r\n\t\t\tconfig.metricSpecs[metricName].categoryList = categoryList\r\n\r\n\t\t\tif (\r\n\t\t\t\tconfig.metricSpecs[metricName].domain !== null &&\r\n\t\t\t\tconfig.metricSpecs[metricName].metric !== null &&\r\n\t\t\t\tcategoryString !== null\r\n\t\t\t) {\r\n\t\t\t\tconst domain = config.metricSpecs[metricName].domain as string\r\n\t\t\t\tconst metric = config.metricSpecs[metricName].metric as string\r\n\r\n\t\t\t\tconst domainObj = (config.fieldSpecs[domain] = config.fieldSpecs[domain] || {})\r\n\t\t\t\tconst categoryObj = categoryString\r\n\t\t\t\t\t? (domainObj[categoryString] = domainObj[categoryString] || {})\r\n\t\t\t\t\t: null\r\n\r\n\t\t\t\tif (categoryObj && !(metric in categoryObj)) {\r\n\t\t\t\t\tcategoryObj[metric] = {\r\n\t\t\t\t\t\tname: config.metricSpecs[metricName].name,\r\n\t\t\t\t\t\tnote: config.metricSpecs[metricName].note,\r\n\t\t\t\t\t\tdecimal: config.metricSpecs[metricName].decimal,\r\n\t\t\t\t\t\tunit: config.metricSpecs[metricName].unit,\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function annotatedWebConfig(\r\n\twebApiURL: string = '',\r\n\tconfig: AnnotatedWebAPIConfig | null,\r\n\tmapStruct: any,\r\n\twebApiClient: WebAPIClient,\r\n): Promise<AnnotatedWebConfig> {\r\n\tif (config != null || mapStruct != null) {\r\n\t\treturn Promise.resolve(new AnnotatedWebConfig(config as AnnotatedWebAPIConfig, mapStruct, webApiClient))\r\n\t}\r\n\tif (webApiClient == null) {\r\n\t\twebApiClient = new WebAPIClient(webApiURL)\r\n\t}\r\n\treturn Promise.all([webApiClient.getConfig(), webApiClient.getGeoStruct()]).then(\r\n\t\tdata => {\r\n\t\t\tconst { data: cfg } = data[0]\r\n\t\t\tconst { data: Map } = data[1]\r\n\t\t\tconst webApiConfig = (cfg as unknown) as AnnotatedWebAPIConfig\r\n\t\t\tannotateWebConfig(webApiConfig) // add axis,axisValue,domain,metric fields\r\n\r\n\t\t\treturn new AnnotatedWebConfig(webApiConfig, Map, webApiClient)\r\n\t\t},\r\n\t)\r\n}\r\n\r\n// share webConfig in the whole application\r\nlet installed: Promise<AnnotatedWebConfig>\r\n\r\n\r\nexport function globalConfig(\r\n\twebApiURL: string = '',\r\n\tconfig: AnnotatedWebAPIConfig | null = null,\r\n\tmapStruct: any = null,\r\n\twebApiClient: WebAPIClient = null,\r\n): Promise<AnnotatedWebConfig> {\r\n\tif (installed) {\r\n\t\treturn installed\r\n\t}\r\n\tinstalled = annotatedWebConfig(webApiURL, config, mapStruct, webApiClient)\r\n\treturn installed\r\n}\r\n\r\nexport interface TimeseriesDataPoint {\r\n\ttimestamp: number\r\n\tvalue: Value\r\n\tsum?: number\r\n}\r\n\r\n/**\r\n * Check if any of the elements in elementCategories belongs to\r\n * categories\r\n * @param elementCategories\r\n * @param categories\r\n */\r\nfunction categoryMatch(elementCategories: string[], categories: string[]): boolean {\r\n\treturn elementCategories.some(elementCategory => categories.indexOf(elementCategory) !== -1)\r\n}\r\n\r\nexport class AnnotatedWebConfig {\r\n\tprivate config: AnnotatedWebAPIConfig\r\n\tprivate readonly mapStruct: any\r\n\tprivate client: WebAPIClient\r\n\tprivate webConfig: WebConfig\r\n\r\n\tconstructor(config: AnnotatedWebAPIConfig, mapStruct: any, client: WebAPIClient) {\r\n\t\tthis.config = config\r\n\t\tthis.mapStruct = mapStruct\r\n\t\tthis.client = client\r\n\t\tthis.webConfig = new WebConfig(config, mapStruct, client)\r\n\t\t// @ts-ignore\r\n\t\tif (global) {\r\n\t\t\t// @ts-ignore\r\n\t\t\tglobal._config = this\r\n\t\t} else {\r\n\t\t\t// @ts-ignore\r\n\t\t\twindow._config = this\r\n\t\t}\r\n\t\tsetGeoStruct(mapStruct, this.getGeoSubLevels())\r\n\t}\r\n\r\n\tpublic filterMetrics(\r\n\t\tmetricType: string,\r\n\t\tgeoLevels: string[],\r\n\t\taxis: string,\r\n\t\taxisValues: string[],\r\n\t\tdomain: string,\r\n\t\tcategories: string[],\r\n\t\tmetrics: string[],\r\n\t\tresolution: string,\r\n\t): {\r\n\t\t[metricName: string]: AnnotatedMetricSpec\r\n\t} {\r\n\t\tconst result = {}\r\n\t\tif (geoLevels.length === 0) {\r\n\t\t\treturn result\r\n\t\t}\r\n\t\t// metricName: 'axis$axisValue.domain.metric' ; metric example at the bottom\r\n\t\tfor (const metricName of Object.keys(this.config.metricSpecs)) {\r\n\t\t\tconst metric = this.config.metricSpecs[metricName]\r\n\t\t\tif (axis !== null && metric.axis !== axis) {\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\tif (axisValues !== null && axisValues.indexOf(metric.axisValue as string) === -1) {\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\tif (domain !== null && metric.domain !== domain) {\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\tif (categories !== null && !categoryMatch(metric.categoryList as string[], categories)) {\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\tif (metrics !== null && metrics.indexOf(metric.metric as string) === -1) {\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\tif (metricType === 'timeseries') {\r\n\t\t\t\tif (metric.querySpecs && metric.querySpecs.timeseries) {\r\n\t\t\t\t\tlet current = metric.querySpecs.timeseries\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tgeoLevels.some(level => {\r\n\t\t\t\t\t\t\tif (current[level]) {\r\n\t\t\t\t\t\t\t\tcurrent = current[level]\r\n\t\t\t\t\t\t\t\treturn false\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treturn true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (current.periods) {\r\n\t\t\t\t\t\t\tif (resolution !== null && current.periods.indexOf(resolution) === -1) {\r\n\t\t\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresult[metricName] = metric\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result\r\n\t}\r\n\r\n\tpublic getGeoSpecFromGeoNotation(notation: string): GeoSpec {\r\n\t\treturn this.webConfig.getGeoSpecFromGeoNotation(notation)\r\n\t}\r\n\r\n\tpublic getGeoNotationFromGeoSpec(geoSpec: GeoSpec): string {\r\n\t\treturn this.webConfig.getGeoNotationFromGeoSpec(geoSpec)\r\n\t}\r\n\r\n\tpublic getGeoLevels(geoSpec: GeoSpec): string[] {\r\n\t\tconst result: string[] = []\r\n\t\tthis.config.geoLevels.some(level => {\r\n\t\t\tif (!this.webConfig.isGeoFieldEmpty(geoSpec[level])) {\r\n\t\t\t\tresult.push(level)\r\n\t\t\t\treturn false\r\n\t\t\t} else {\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn result\r\n\t}\r\n\r\n\t/**\r\n\t * 获取完整的geo层级\r\n\t *\r\n\t * @returns {string[]}\r\n\t * @memberof AnnotatedWebConfig\r\n\t */\r\n\tpublic getGeoRootLevels(): string[] {\r\n\t\treturn this.config.geoLevels.slice()\r\n\t}\r\n\r\n\t/**\r\n\t * 获取顶级组织下的子geo层级，即不包含enterprise\r\n\t *\r\n\t * @returns {string[]}\r\n\t * @memberof AnnotatedWebConfig\r\n\t */\r\n\tpublic getGeoSubLevels(): string[] {\r\n\t\treturn this.config.geoSubLevels.slice()\r\n\t}\r\n\r\n\t// public getAdmGeoList(geoSpec: GeoSpec, level: number): object {\r\n\t// \treturn this.webConfig.getAdmGeoList(geoSpec, level)\r\n\t// }\r\n\r\n\tpublic getMapStruct() {\r\n\t\treturn cloneDeep(this.mapStruct)\r\n\t}\r\n\r\n\tpublic json2array() {\r\n\t\tconst mapStruct = this.mapStruct\r\n\t\tconst levels = this.config.geoSubLevels\r\n\r\n\t\t// geoSubLevels: [\"factory\", \"workshop\", \"line\", \"equipment_product_shift\"]\r\n\r\n\t\t// 仪表采集，氧气管网，供电公司，供水公司等不在top menu中显示\r\n\t\tconst excludeFactory = ['MeterBus', 'MeterCollection', 'OxygenPipeline', 'GasFactory', 'ElectricityProvider', 'WaterProvider']\r\n\r\n\t\tfunction _json2array(json, level, name) {\r\n\t\t\tif (level > levels.length) {\r\n\t\t\t\treturn []\r\n\t\t\t}\r\n\t\t\tlet arr = []\r\n\t\t\tconst currObj = json[levels[level]]\r\n\t\t\t// remove line level from organization\r\n\t\t\tif (level === 2) {\r\n\t\t\t\tfor (const item in currObj) {\r\n\t\t\t\t\tif (currObj.hasOwnProperty(item)) {\r\n\t\t\t\t\t\tconst tmpSub = _json2array(currObj[item], level + 1, name + '|' + currObj[item].name)\r\n\t\t\t\t\t\tarr = [...arr, ...tmpSub]\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn arr\r\n\t\t\t}\r\n\r\n\t\t\tfor (const item in currObj) {\r\n\t\t\t\tif (\r\n\t\t\t\t\tcurrObj.hasOwnProperty(item) &&\r\n\t\t\t\t\t!excludeFactory.find(e => currObj[item].class[0].fqn.split('}')[1] === e)\r\n\t\t\t\t\t// !excludeFactory.find(e => currObj[item].class[0].fqn.match(/(?<=\\})\\w+/g)[0] === e)\r\n\t\t\t\t) {\r\n\t\t\t\t\tconst tmpSub = _json2array(currObj[item], level + 1, name + '|' + currObj[item].name)\r\n\t\t\t\t\t// remove equipment type at equipment_product_shift level\r\n\t\t\t\t\tif (level === 3 && currObj[item].class[0].fqn.indexOf('Machine') !== -1) {\r\n\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t}\r\n\t\t\t\t\tarr.push({\r\n\t\t\t\t\t\tlevel: levels[level],\r\n\t\t\t\t\t\tgeo: name + '|' + currObj[item].name,\r\n\t\t\t\t\t\tprocess: currObj[item].axis ? currObj[item].axis.process : [],\r\n\t\t\t\t\t\tclass: currObj[item].class,\r\n\t\t\t\t\t\ti18n: currObj[item].i18n,\r\n\t\t\t\t\t\tsub: tmpSub,\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn arr\r\n\t\t}\r\n\r\n\t\tconst sub = _json2array(mapStruct, 0, mapStruct.name)\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\tlevel: this.config.geoLevels[0],\r\n\t\t\t\tgeo: mapStruct.name,\r\n\t\t\t\tclass: mapStruct.class,\r\n\t\t\t\ti18n: mapStruct.i18n,\r\n\t\t\t\tsub,\r\n\t\t\t\tprocess: mapStruct.axis.process,\r\n\t\t\t},\r\n\t\t]\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param queries\r\n\t * [{from: 1539129600000\r\n\t *  geo: \"zb_e\"\r\n\t *  id: \"process$blast_furnance.Consumption.oxygen\"\r\n\t *  metricType: \"timeseries\"\r\n\t *  name: \"process$blast_furnance.Consumption.oxygen\"\r\n\t *  period: \"1h\"\r\n\t *  to: 1547388445646}]\r\n\t *\r\n\t *  @return\r\n\t */\r\n\tpublic timeseries(\r\n\t\tqueries: MetricQuery[],\r\n\t): Promise<Array<{\r\n\t\tid: string\r\n\t\tdata: TimeseriesDataPoint[]\r\n\t}>> {\r\n\t\treturn this.client\r\n\t\t\t.getData(queries)\r\n\t\t\t.then((queryResult: Array<{ metricType: string; id: string; data: DataPoint[] }>) => {\r\n\t\t\t\tconst result: Array<{\r\n\t\t\t\t\tid: string\r\n\t\t\t\t\tdata: TimeseriesDataPoint[]\r\n\t\t\t\t}> = []\r\n\t\t\t\tfor (const item of queryResult) {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tconst { metricType, id, data } = item.data\r\n\t\t\t\t\tif (metricType === 'timeseries') {\r\n\t\t\t\t\t\tresult.push({\r\n\t\t\t\t\t\t\tid,\r\n\t\t\t\t\t\t\tdata: data.map(({ name, value }) => ({\r\n\t\t\t\t\t\t\t\ttimestamp: parseFloat(name),\r\n\t\t\t\t\t\t\t\tvalue,\r\n\t\t\t\t\t\t\t})),\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn result\r\n\t\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * @param domain\r\n\t * @param filter -- a string or an array of strings (for multiple disjuncts)\r\n\t * @param id -- an array of strings\r\n\t *\r\n\t */\r\n\tpublic search(domain: string, filter: string[], id: string[], _options?: object) {\r\n\t\treturn this.webConfig.search(domain, filter, id, _options)\r\n\t}\r\n\r\n\t/**\r\n\t * 修改整个模型对象或新建模型对象\r\n\t * 注意会整体覆盖，所以需要将原有属性保留 { ...originalValue,newValue }\r\n\t * Creates or updates object with specified domain data.\r\n\t * @param objectId object id\r\n\t * @param scope equipment object id, ie \"zb_e|rolling_f1|bar_w1|bar_l1\" . instruction has no scope,so should be set null\r\n\t * @param domain domain, mixin type, ie \"Target\",\"steel___OxygenPipelineInstruction\"\r\n\t * @param data data, mixin value,ie {state:'accepted'}\r\n\t * @result\r\n\t *\r\n\t */\r\n\tpublic createOrUpdateEntity(objectId: string, scope: string, domain: string, data: object, _options?: object) {\r\n\t\treturn this.webConfig.createOrUpdateEntity(objectId, scope, domain, data, _options)\r\n\t}\r\n\r\n\t/**\r\n\t * Return the array of tuples (key, value) where X <= key < Y\r\n\t * @param id object id\r\n\t * @param domain domain, mixin type, ie \"Target\"\r\n\t * @param name map name\r\n\t * @param from lower bound of the key 值必须可以计算\r\n\t * @param to upper bound of the key\r\n\t */\r\n\tpublic getMapValues(id: string, domain: string, name: string, from: string, to: string, _options?: object) {\r\n\t\treturn this.webConfig.getMapValues(id, domain, name, from, to, _options)\r\n\t}\r\n\r\n\t/**\r\n\t * Returns key value\r\n\t * @param id object id\r\n\t * @param domain domain, mixin type, ie \"Target\"\r\n\t * @param name map name\r\n\t * @param key\r\n\t */\r\n\tpublic getMapValue(id: string, domain: string, name: string, key: string, _options?: object) {\r\n\t\treturn this.webConfig.getMapValue(id, domain, name, key, _options)\r\n\t}\r\n\r\n\t/**\r\n\t * 模型对象必须存在，否则先用createOrUpdateEntity()创建\r\n\t * 给模型对象添加一个自定义的属性（若无）${name},值为[ ...  {  key:${key}, value:${value} } ... ],value可以为任意类型。key推荐为连续的值，如时间戳，方便查询。\r\n\t * 如果指定的属性存在，则数组新增一个value对象。key的值必须不同，否则会返回500错误。\r\n\t * 如果需要修改指定key对应的value，使用 editMapValue api。\r\n\t * Add the value to the customized or specified field of map\r\n\t * @param id : object id  ie  instruction ID:  \"zb_e|oxygen_p1|oxygen_p1_1552357589\",\r\n\t * @param domain : domain, mixin type,    ie \"Target\" , \"steel___OxygenPipelineInstruction\"\r\n\t * @param name : name of filed gonna to add/modify     ie: actions\r\n\t * @param key : key to new data\r\n\t * @param value : value is either a primitive type or a object\r\n\t * @example\r\n\t window._config.addValueToMap(\r\n\t \"zb_e|oxygen_p1|oxygen_p1_1552444028\",      // instruction ID\r\n\t \"steel___OxygenPipelineInstruction\",        // domain\r\n\t \"actions\",                                  // customized field name\r\n\t `${new Date().getTime()}`,      // used as new entry ID; recommend to use timestamp for uniqueness and ordering.\r\n\t { user:\"iron_f1\",log: \"changed state from new to accepted\" }\r\n\t )\r\n\t result:{\r\n            id: \"zb_e|oxygen_p1|oxygen_p1_1552444028\"\r\n            steel___OxygenPipelineInstruction:{\r\n                actions:[{\r\n                    key: \"1552444095543\"\r\n                    value: {user: \"iron_f1\",log: \"changed state from new to accepted\" }\r\n                }]\r\n            }\r\n        }\r\n\t */\r\n\tpublic addValueToMap(id: string, domain: string, name: string, key: string, value: any, _options?: object) {\r\n\t\treturn this.webConfig.addValueToMap(id, domain, name, key, value, _options)\r\n\t}\r\n\r\n\t/**\r\n\t * Edit the value in the map\r\n\t * @param id object id\r\n\t * @param domain domain, mixin type, ie \"Target\"\r\n\t * @param name map name\r\n\t * @param key\r\n\t * @param value the value is either a primitive type or a document\r\n\t */\r\n\tpublic editMapValue(id: string, domain: string, name: string, key: string, value: any, _options?: object) {\r\n\t\treturn this.webConfig.editMapValue(id, domain, name, key, value, _options)\r\n\t}\r\n\r\n\t/**\r\n\t * Delete the map value\r\n\t * @param id object id\r\n\t * @param domain domain, mixin type, ie \"Target\"\r\n\t * @param name map name\r\n\t * @param key\r\n\t */\r\n\tpublic deleteMapValue(id: string, domain: string, name: string, key: string, _options?: object) {\r\n\t\treturn this.webConfig.deleteMapValue(id, domain, name, key, _options)\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves domain data from object.\r\n\t * @param objectId object id，ie:'zb_e|oxygen_p1|oxygen_p1_1552357589'\r\n\t * @param domain domain/mixin type, ie:\"steel___OxygenPipelineInstruction\"\r\n\t */\r\n\tpublic getObjectDomain(objectId: string, domain: string, _options?: object) {\r\n\t\treturn this.webConfig.getObjectDomain(objectId, domain, _options)\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t *  @return\r\n\t */\r\n\tpublic timeseriesBatch(\r\n\t\tqueries: BatchTimeseriesQuery[],\r\n\t\t_options?: object\r\n\t): Promise<Array<{\r\n\t\t[name: string]: TimeseriesDataPoint[]\r\n\t}>> {\r\n\t\treturn this.client.getTimeseriesBatch(queries, _options).then(results => {\r\n\t\t\tconst result: Array<{\r\n\t\t\t\t[name: string]: TimeseriesDataPoint[]\r\n\t\t\t}> = []\r\n\t\t\tfor (const data of results) {\r\n\t\t\t\tconst item: {\r\n\t\t\t\t\t[name: string]: TimeseriesDataPoint[]\r\n\t\t\t\t} = {}\r\n\t\t\t\tfor (const metric of Object.keys(data)) {\r\n\t\t\t\t\titem[metric] = data[metric].map(({ name, value }) => ({\r\n\t\t\t\t\t\ttimestamp: parseFloat(name),\r\n\t\t\t\t\t\tvalue,\r\n\t\t\t\t\t}))\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(item)\r\n\t\t\t}\r\n\t\t\treturn result\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t *  @return\r\n\t */\r\n\tpublic timeseriesMultiBatch(\r\n\t\tqueries: BatchTimeseriesQuery[],\r\n\t\tnoPrune: boolean = false,\r\n\t\t_options?: object\r\n\t): Promise<{\r\n\t\t[name: string]: TimeseriesDataPoint[]\r\n\t}> {\r\n\t\treturn this.client.getTimeseriesMultiBatch(queries, noPrune, _options).then(data => {\r\n\t\t\tconst result: {\r\n\t\t\t\t[name: string]: TimeseriesDataPoint[]\r\n\t\t\t} = {}\r\n\t\t\tfor (const metric of Object.keys(data)) {\r\n\t\t\t\tresult[metric] = data[metric].map(({ name, value }) => ({\r\n\t\t\t\t\ttimestamp: parseFloat(name),\r\n\t\t\t\t\tvalue,\r\n\t\t\t\t}))\r\n\t\t\t}\r\n\t\t\treturn result\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Find objects specified by the filter. If filter element is null, skip this element\r\n\t *\r\n\t */\r\n\tpublic findObjects({\r\n\t\tclasses = null,\r\n\t}: {\r\n\t\tclasses?: string[]\r\n\t}): Array<{\r\n\t\t// object geo spec\r\n\t\tkey: GeoSpec\r\n\t\t// object spec\r\n\t\tspec: ObjectSpec\r\n\t}> {\r\n\t\tconst result: {\r\n\t\t\t[geo: string]: {\r\n\t\t\t\tkey: GeoSpec\r\n\t\t\t\tspec: ObjectSpec\r\n\t\t\t}\r\n\t\t} = {}\r\n\t\tthis._findObjects(\r\n\t\t\tthis.mapStruct,\r\n\t\t\tthis.mapStruct.name,\r\n\t\t\t{\r\n\t\t\t\t[this.config.geoLevels[0]]: this.mapStruct.name,\r\n\t\t\t},\r\n\t\t\tthis.config.geoLevels.slice(1),\r\n\t\t\t{\r\n\t\t\t\tclasses,\r\n\t\t\t},\r\n\t\t\tresult,\r\n\t\t)\r\n\t\tconst resultList: Array<{\r\n\t\t\tkey: GeoSpec\r\n\t\t\tspec: ObjectSpec\r\n\t\t}> = []\r\n\t\tfor (const geo of Object.keys(result)) {\r\n\t\t\tresultList.push(result[geo])\r\n\t\t}\r\n\t\treturn resultList\r\n\t}\r\n\r\n\tpublic isInstance(obj: GeoSpec, cls: string): boolean {\r\n\t\tconst inputObj = this._findObjectByGeoSpec(obj)\r\n\t\tconst classes = inputObj.spec.class\r\n\t\tfor (const c of classes) {\r\n\t\t\tif (cls === c.fqn) {\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false\r\n\t}\r\n\r\n\tpublic getSources(\r\n\t\tobj: GeoSpec,\r\n\t\trelationType: string,\r\n\t): Array<{\r\n\t\t// object geo spec\r\n\t\tkey: GeoSpec\r\n\t\t// object spec\r\n\t\tspec: ObjectSpec\r\n\t}> {\r\n\t\tconst result: {\r\n\t\t\t[geo: string]: {\r\n\t\t\t\tkey: GeoSpec\r\n\t\t\t\tspec: ObjectSpec\r\n\t\t\t}\r\n\t\t} = {}\r\n\t\tconst geoNotation = this.getGeoNotationFromGeoSpec(obj)\r\n\t\tthis._findObjectsByRelation(\r\n\t\t\tthis.mapStruct,\r\n\t\t\tthis.mapStruct.name,\r\n\t\t\t{\r\n\t\t\t\t[this.config.geoLevels[0]]: this.mapStruct.name,\r\n\t\t\t},\r\n\t\t\tthis.config.geoLevels.slice(1),\r\n\t\t\t{\r\n\t\t\t\trelations: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: relationType,\r\n\t\t\t\t\t\tdestination: geoNotation,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t},\r\n\t\t\tresult,\r\n\t\t)\r\n\t\tconst resultList: Array<{\r\n\t\t\tkey: GeoSpec\r\n\t\t\tspec: ObjectSpec\r\n\t\t}> = []\r\n\t\tfor (const geo of Object.keys(result)) {\r\n\t\t\tresultList.push(result[geo])\r\n\t\t}\r\n\t\treturn resultList\r\n\t}\r\n\r\n\tpublic getDestinations(\r\n\t\tobj: GeoSpec,\r\n\t\trelationType: string,\r\n\t): Array<{\r\n\t\t// object geo spec\r\n\t\tkey: GeoSpec\r\n\t\t// object spec\r\n\t\tspec: ObjectSpec\r\n\t}> {\r\n\t\tconst inputObj = this._findObjectByGeoSpec(obj)\r\n\t\tconst resultList: Array<{\r\n\t\t\tkey: GeoSpec\r\n\t\t\tspec: ObjectSpec\r\n\t\t}> = []\r\n\t\tconst relations = (inputObj.spec as any).related as [{ destination: string; type: string }]\r\n\t\tif (relations) {\r\n\t\t\tfor (const relation of relations) {\r\n\t\t\t\tif (relation.type === relationType) {\r\n\t\t\t\t\tconst geoNotation = relation.destination\r\n\t\t\t\t\tconst resultObj = this._findObjectByGeoNotation(geoNotation)\r\n\t\t\t\t\tif (resultObj) {\r\n\t\t\t\t\t\tresultList.push(resultObj)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn resultList\r\n\t}\r\n\r\n\tprivate _findObjects(\r\n\t\t// subtree root spec\r\n\t\troot: ObjectSpec,\r\n\t\t// subtree root GeoNotation (a|b|c...)\r\n\t\tgeo: string,\r\n\t\t// subtree root GeoSpec\r\n\t\t// { leve0: a, level1: b, ... }\r\n\t\tgeoSpec: GeoSpec,\r\n\t\t// list of geo levels [level+1, level+2, ...]\r\n\t\tsubLevels: string[],\r\n\t\t// object filter\r\n\t\tfilter: {\r\n\t\t\t// currently only support class filter\r\n\t\t\tclasses: string[]\r\n\t\t},\r\n\t\t// result map\r\n\t\tresult: {\r\n\t\t\t[geo: string]: {\r\n\t\t\t\tkey: GeoSpec\r\n\t\t\t\tspec: ObjectSpec\r\n\t\t\t}\r\n\t\t},\r\n\t) {\r\n\t\t// match root\r\n\t\tlet match = true\r\n\t\tif (filter.classes !== null) {\r\n\t\t\tlet notFound = true\r\n\t\t\tfor (const aClass of filter.classes) {\r\n\t\t\t\tif (root.class !== null && root.class.some(({ fqn }) => fqn === aClass)) {\r\n\t\t\t\t\tnotFound = false\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (notFound) {\r\n\t\t\t\tmatch = false\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (match) {\r\n\t\t\tresult[geo] = {\r\n\t\t\t\tkey: geoSpec,\r\n\t\t\t\tspec: root,\r\n\t\t\t}\r\n\t\t}\r\n\t\t// walk the subtree recursively\r\n\t\tif (subLevels.length > 0) {\r\n\t\t\tconst children = (root as any)[subLevels[0]] as {\r\n\t\t\t\t[id: string]: ObjectSpec\r\n\t\t\t}\r\n\t\t\tif (!!children) {\r\n\t\t\t\tfor (const id of Object.keys(children)) {\r\n\t\t\t\t\tthis._findObjects(\r\n\t\t\t\t\t\tchildren[id],\r\n\t\t\t\t\t\t`${geo}|${id}`,\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t...geoSpec,\r\n\t\t\t\t\t\t\t[subLevels[0]]: id,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsubLevels.slice(1),\r\n\t\t\t\t\t\tfilter,\r\n\t\t\t\t\t\tresult,\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _findObjectsByRelation(\r\n\t\t// todo: this method is copy from _findObjects and change `filter`. should it be merged into _findObjects\r\n\t\t// subtree root spec\r\n\t\troot: ObjectSpec,\r\n\t\t// subtree root GeoNotation (a|b|c...)\r\n\t\tgeo: string,\r\n\t\t// subtree root GeoSpec\r\n\t\t// { leve0: a, level1: b, ... }\r\n\t\tgeoSpec: GeoSpec,\r\n\t\t// list of geo levels [level+1, level+2, ...]\r\n\t\tsubLevels: string[],\r\n\t\t// object filter\r\n\t\tfilter: {\r\n\t\t\t// classes: string[]\r\n\t\t\trelations: Array<{ type: string; destination: string }>\r\n\t\t},\r\n\t\t// result map\r\n\t\tresult: {\r\n\t\t\t[geo: string]: {\r\n\t\t\t\tkey: GeoSpec\r\n\t\t\t\tspec: ObjectSpec\r\n\t\t\t}\r\n\t\t},\r\n\t) {\r\n\t\t// match root\r\n\t\t// let match = true\r\n\t\t// if (filter.classes !== null) {\r\n\t\t//     let notFound = true\r\n\t\t//     for (const aClass of filter.classes) {\r\n\t\t//         if (root.class !== null && root.class.some(({ fqn }) => fqn === aClass)) {\r\n\t\t//             notFound = false\r\n\t\t//             break\r\n\t\t//         }\r\n\t\t//         if (notFound) {\r\n\t\t//             match = match && false\r\n\t\t//         }\r\n\t\t//     }\r\n\t\t// }\r\n\r\n\t\t// match root\r\n\t\tlet match = true\r\n\t\tif (filter.relations !== null) {\r\n\t\t\tlet notFound = true\r\n\t\t\tfor (const aRelation of filter.relations) {\r\n\t\t\t\tif (\r\n\t\t\t\t\t(root as any).related !== undefined &&\r\n\t\t\t\t\t(root as any).related !== null &&\r\n\t\t\t\t\t(root as any).related.some(\r\n\t\t\t\t\t\t({ type, destination }) => type === aRelation.type && destination === aRelation.destination,\r\n\t\t\t\t\t)\r\n\t\t\t\t) {\r\n\t\t\t\t\tnotFound = false\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (notFound) {\r\n\t\t\t\tmatch = false\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (match) {\r\n\t\t\tresult[geo] = {\r\n\t\t\t\tkey: geoSpec,\r\n\t\t\t\tspec: root,\r\n\t\t\t}\r\n\t\t}\r\n\t\t// walk the subtree recursively\r\n\t\tif (subLevels.length > 0) {\r\n\t\t\tconst children = (root as any)[subLevels[0]] as {\r\n\t\t\t\t[id: string]: ObjectSpec\r\n\t\t\t}\r\n\t\t\tif (!!children) {\r\n\t\t\t\tfor (const id of Object.keys(children)) {\r\n\t\t\t\t\tthis._findObjectsByRelation(\r\n\t\t\t\t\t\tchildren[id],\r\n\t\t\t\t\t\t`${geo}|${id}`,\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t...geoSpec,\r\n\t\t\t\t\t\t\t[subLevels[0]]: id,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsubLevels.slice(1),\r\n\t\t\t\t\t\tfilter,\r\n\t\t\t\t\t\tresult,\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _findObjectByGeoNotation(\r\n\t\tgeoNotation: string,\r\n\t): {\r\n\t\t// object geo spec\r\n\t\tkey: GeoSpec\r\n\t\t// object spec\r\n\t\tspec: ObjectSpec\r\n\t} {\r\n\t\tlet geoDelimiter = (this.config as any).geoDelimiter\r\n\t\tif (!geoDelimiter) {\r\n\t\t\tgeoDelimiter = '|'\r\n\t\t}\r\n\t\tconst geoLevels = this.config.geoLevels\r\n\t\tconst targetGeoFields = geoNotation.split(geoDelimiter)\r\n\t\tconst resultKey = {}\r\n\t\tlet obj = this.mapStruct\r\n\t\tif (targetGeoFields.length <= geoLevels.length) {\r\n\t\t\tfor (let i = 0; i < targetGeoFields.length; i++) {\r\n\t\t\t\tconst level = geoLevels[i]\r\n\t\t\t\tconst field = targetGeoFields[i]\r\n\t\t\t\tresultKey[level] = field\r\n\t\t\t\tif (i === 0) {\r\n\t\t\t\t\tif (field !== obj.name) {\r\n\t\t\t\t\t\tthrow new Error(`unexpected geo field ${field} on geo level ${level}`)\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj = obj[level][field]\r\n\t\t\t\t\tif (!obj) {\r\n\t\t\t\t\t\tthrow new Error(`unexpected geo field ${field} on geo level ${level}`)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tkey: resultKey,\r\n\t\t\tspec: obj,\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _findObjectByGeoSpec(\r\n\t\tgeoSpec: GeoSpec,\r\n\t): {\r\n\t\tkey: GeoSpec\r\n\t\tspec: ObjectSpec\r\n\t} {\r\n\t\tconst geoLevels = this.config.geoLevels\r\n\t\tlet obj = this.mapStruct\r\n\t\tconst geoSpecLength = Object.keys(geoSpec).length\r\n\t\tif (geoSpecLength <= geoLevels.length) {\r\n\t\t\tfor (let i = 0; i < geoSpecLength; i++) {\r\n\t\t\t\tconst level = geoLevels[i]\r\n\t\t\t\tconst field = geoSpec[level]\r\n\t\t\t\tif (i === 0) {\r\n\t\t\t\t\tif (field !== obj.name) {\r\n\t\t\t\t\t\tthrow new Error(`unexpected geo field ${field} on geo level ${level}`)\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj = obj[level][field]\r\n\t\t\t\t\tif (!obj) {\r\n\t\t\t\t\t\tthrow new Error(`unexpected geo field ${field} on geo level ${level}`)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tkey: geoSpec,\r\n\t\t\tspec: obj,\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//\r\nexport function aggregateTimeseries(timeseries: TimeseriesDataPoint[][]): TimeseriesDataPoint[] {\r\n\tconst result: TimeseriesDataPoint[] = []\r\n\t//@ts-ignore\r\n\tconst indices: number[] = timeseries.map(data => -1)\r\n\r\n\twhile (true) {\r\n\t\tlet stop = true\r\n\t\tlet minIdx = -1\r\n\t\tfor (let i = 0; i < indices.length; i++) {\r\n\t\t\tif (indices[i] + 1 < timeseries[i].length) {\r\n\t\t\t\tif (minIdx === -1) {\r\n\t\t\t\t\tminIdx = i\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (timeseries[i][indices[i] + 1].timestamp < timeseries[minIdx][indices[minIdx] + 1].timestamp) {\r\n\t\t\t\t\t\tminIdx = i\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tstop = false\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (stop) {\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tconst timestamp = timeseries[minIdx][indices[minIdx] + 1].timestamp\r\n\t\tconst value: Value = {\r\n\t\t\tsum: 0,\r\n\t\t\tcnt: 0,\r\n\t\t\tmax: 0,\r\n\t\t\tmin: 0,\r\n\t\t\tstddev: 0,\r\n\t\t}\r\n\t\tfor (let i = 0; i < indices.length; i++) {\r\n\t\t\tif (indices[i] + 1 < timeseries[i].length) {\r\n\t\t\t\tif (timeseries[i][indices[i] + 1].timestamp === timestamp) {\r\n\t\t\t\t\tvalue.sum += timeseries[i][indices[i] + 1].value.sum\r\n\t\t\t\t\tvalue.cnt += timeseries[i][indices[i] + 1].value.cnt\r\n\t\t\t\t\tif (value.cnt > 0) {\r\n\t\t\t\t\t\tvalue.min = Math.min(value.min, timeseries[i][indices[i] + 1].value.min)\r\n\t\t\t\t\t\tvalue.max = Math.min(value.min, timeseries[i][indices[i] + 1].value.max)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tindices[i] += 1\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tresult.push({ timestamp, value })\r\n\t}\r\n\r\n\treturn result\r\n}\r\n\r\n/**\r\n *  process$blast_furnance.Consumption.oxygen as follows:\r\n * {\r\n * \"category\":\"Gas\",\r\n * \"name\":{\"i18n\":{\"zh-CN\":\"氧气\",\"en-US\":\"Oxygen\"}},\r\n * \"valueType\":\"number:statistics\",\r\n * \"default-stats\":\"avg\",\r\n * \"querySpecs\":{\r\n *      \"timeseries\":{\r\n *          \"enterprise\":{\r\n *              \"periods\":[\"1h\"],\r\n *              \"factory\":{\r\n *                  \"workshop\":{\r\n *                      \"line_shift\":{\r\n *                          \"periods\":[\"1h\"],\r\n *                          \"equipment_product\":{\"periods\":[\"1h\"]}\r\n *                          },\r\n *                       \"periods\":[\"1h\"]\r\n *                   },\r\n *                   \"periods\":[\"1h\"]}\r\n *              }\r\n *        }\r\n *   },\r\n *  \"note\":{\"i18n\":{\"zh-CN\":\"氧气消耗量\",\"en-US\":\"Oxygen Consumption\"}},\r\n *  \"timezone\":\"UTC\",\r\n *  \"decimal\":3,\r\n *  \"unit\":\"m³\",\r\n *  \"axis\":\"process\",\r\n *  \"axisValue\":\"blast_furnance\",\r\n *  \"domain\":\"Consumption\",\r\n *  \"metric\":\"oxygen\"\r\n *  }\r\n */\r\n"],"names":["_.cloneDeep","_.isEmpty","_.isArray","getLabel","cloneDeep"],"mappings":"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"}